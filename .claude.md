# PiTrac Tower Build - Claude Development Rules

## Project Overview
- **Project:** PiTrac - Open source golf ball launch monitor
- **Repository:** pitracLM/pitrac
- **Hardware:** One Raspberry Pi 5 Design
- **Cameras:** 2x IMX296 global shutter cameras
- **Enclosure:** Enclosure 2 with Connect Board V1
- **Owner:** lbhales

---

## MANDATORY RULES (Never Skip These)

### Rule 1: Three-Cycle Ralph Loop
Every task MUST go through a true 3-cycle Ralph Loop before it is considered done:

**Cycle 1 - RED (Write It)**
- Write the code, script, or configuration
- Write the matching test(s) FIRST if possible (test-driven)
- Run the test - it SHOULD fail (proves the test catches problems)

**Cycle 2 - GREEN (Make It Work)**
- Fix/adjust the code until ALL tests pass
- No hacks, no skipping, no "good enough"
- Every test must go green

**Cycle 3 - REFACTOR (Make It Right)**
- Clean up the code while keeping tests green
- Apply camelCase naming conventions
- Remove duplication, improve clarity
- Run tests ONE MORE TIME to confirm nothing broke

**A task is NOT done until all 3 cycles are complete and passing.**

### Rule 2: Barney-Style Explanations
- Explain everything simply and completely, like teaching a curious friend
- Use plain English first, then technical terms with definitions
- Include EVERY step - never assume the reader "just knows"
- Show exact commands to type, exact files to edit, exact locations
- When something could go wrong, say what to look for and how to fix it
- Use analogies from everyday life when helpful
- Goal: Zero follow-up questions needed

### Rule 3: Update All .md Files Every 10 Chat Outputs
- After every 10 assistant messages in a session, refresh ALL markdown files:
  - `.claude.md` (this file) - update if rules evolved
  - `handoff.md` - always update with latest state
  - `projectStatus.md` - update progress tracking
  - Any other .md files in the project
- This keeps documentation alive and accurate, never stale

### Rule 4: Maintain handoff.md
- `handoff.md` must ALWAYS reflect the current state of the project
- What was done, what's in progress, what's next
- Any blockers, gotchas, or things to watch out for
- Hardware state and configuration notes
- Updated every time meaningful work is completed

### Rule 5: /clear After Every Completed Task
- After a task passes all 3 Ralph Loop cycles AND visual inspection (if relevant):
  - Update handoff.md with completion notes
  - Commit all changes
  - Then /clear to start fresh for the next task
- This keeps context clean and prevents confusion between tasks

### Rule 6: Complete Test Suite
- Every feature/task gets a full test suite (unit tests, like Smalltalk days)
- Tests live in the `tests/` directory, mirroring the source structure
- Test file naming: `test_<moduleName>.py` (or matching language convention)
- Tests run AFTER Ralph Loop passes AND after visual inspection if relevant
- Test categories:
  - **Unit tests:** Individual functions and methods
  - **Integration tests:** Components working together
  - **Hardware tests:** Camera, GPIO, sensor verification (when applicable)
  - **Smoke tests:** Quick "does it even start" checks
- A regression suite accumulates over time - old tests never get deleted

### Rule 7: Smalltalk camelCase Everywhere
- Variables: `ballSpeed`, `cameraFrameRate`, `launchAngle`
- Functions/Methods: `calculateTrajectory()`, `captureFrame()`, `processImage()`
- Files (where possible): `cameraConfig.py`, `ballTracker.py`
- Constants: `maxFrameRate`, `defaultExposure` (still camelCase, NOT SCREAMING_SNAKE)
- Test files: `test_ballTracker.py` (test_ prefix required by pytest, then camelCase)
- Class names: PascalCase as is standard (`BallTracker`, `CameraManager`)
- NO snake_case, NO kebab-case, NO SCREAMING_SNAKE_CASE

---

## ADDITIONAL BEST PRACTICES

### Hardware Safety
- NEVER run GPIO/camera commands without confirming hardware is connected
- Always check camera detection (`libcamera-hello --list-cameras`) before camera operations
- Back up working configurations before changing hardware settings
- Document pin assignments and wiring in `hardwareConfig.md` when relevant

### Pi 5 Specific Notes
- Uses `libcamera` stack (not legacy `raspicam`)
- IMX296 cameras need specific dtoverlay configuration
- Connect Board requires I2C configuration for camera switching
- Check `/boot/firmware/config.txt` for camera overlays

### Build & Compile
- Document every dependency installation with exact commands
- Use virtual environments for Python work
- Track versions of everything in `requirements.txt` or equivalent

### Git Workflow
- Commit messages describe WHAT and WHY (not just "updated file")
- Commit after each completed Ralph Loop cycle
- Push to the designated branch: `claude/setup-pitrac-pi5-fvk1C`
- Never force-push without explicit permission

### Session Management
- Start each session by reading `handoff.md`
- End each task by updating `handoff.md`
- The handoff file IS the source of truth between sessions

### Debugging Approach
- When something breaks: read the FULL error message first
- Check the simplest explanation before the complex one
- Add diagnostic output, don't just guess
- Document the fix so it never bites us again

---

## Directory Structure (Expected)
```
PiTracTowerBuild/
├── .claude.md              # This file - development rules
├── handoff.md              # Current project state for session continuity
├── projectStatus.md        # Progress tracking
├── hardwareConfig.md       # Hardware setup and pin assignments
├── tests/                  # All test files
│   ├── test_smoke.py       # Quick sanity checks
│   ├── test_cameraSetup.py # Camera verification tests
│   └── ...
├── scripts/                # Utility and setup scripts
├── config/                 # Configuration files
└── src/                    # Source code
```

---

## Quick Reference: Ralph Loop Checklist
```
[ ] Cycle 1 - RED:    Write code + write test + test FAILS
[ ] Cycle 2 - GREEN:  Fix code + test PASSES
[ ] Cycle 3 - REFACTOR: Clean up + test STILL PASSES
[ ] Visual check (if applicable)
[ ] Full test suite runs clean
[ ] handoff.md updated
[ ] Changes committed and pushed
[ ] /clear for next task
```
